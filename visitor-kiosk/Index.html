<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Visitor Kiosk</title>
  <style>
    body { font-family: sans-serif; background: #222; color: #fff; text-align: center; }
    .page { display: none; }
    .active { display: block; margin-top: 50px; }
    input, button { padding: 10px; margin: 10px; font-size: 1.2em; }
    .host-list { margin: 20px 0; }
    .host { cursor: pointer; padding: 10px; border: 1px solid #888; margin: 5px 0; border-radius: 5px; }
    .host.selected { background: #444; }
  </style>
</head>
<body>
  <h1>Welcome Visitor!</h1>

  <div id="page-name" class="page active">
    <h2>Please enter your name:</h2>
    <input id="visitor-name" placeholder="Your name" autocomplete="off" />
    <br>
    <button onclick="nextFromName()">Next</button>
  </div>

  <div id="page-host" class="page">
    <h2>Who are you here to see?</h2>
    <input id="host-search" placeholder="Enter host name" autocomplete="off" oninput="searchHosts()" />
    <div id="host-results" class="host-list"></div>
    <button id="host-next-btn" onclick="nextFromHost()" disabled>Next</button>
  </div>

  <div id="page-confirm" class="page">
    <h2>Ready to check in?</h2>
    <p id="confirm-msg"></p>
    <button onclick="sendNotification()">Notify Host</button>
  </div>

  <div id="page-done" class="page">
    <h2>You're checked in!</h2>
    <p>Your host has been notified.</p>
    <button onclick="location.reload()">New Visitor</button>
  </div>

  <script>
    // ==== CONFIG ====
    const WEBEX_TOKEN = "YOUR_WEBEX_BOT_TOKEN_HERE"; // <-- PUT YOUR TOKEN HERE

    // ==== STATE ====
    let visitorName = "";
    let selectedHost = null;
    let hostList = [];

    // ==== PAGE FLOW ====
    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function nextFromName() {
      visitorName = document.getElementById("visitor-name").value.trim();
      if (visitorName) {
        showPage('page-host');
        document.getElementById("host-search").focus();
      }
    }

    async function searchHosts() {
      const query = document.getElementById("host-search").value.trim();
      const resultsDiv = document.getElementById("host-results");
      resultsDiv.innerHTML = "";
      selectedHost = null;
      document.getElementById("host-next-btn").disabled = true;

      if (query.length < 2) return;

      // Call Webex People API
      const resp = await fetch(`https://webexapis.com/v1/people?displayName=${encodeURIComponent(query)}`, {
        headers: { Authorization: `Bearer ${WEBEX_TOKEN}` }
      });
      const data = await resp.json();
      hostList = data.items || [];
      hostList.slice(0, 5).forEach((host, idx) => {
        const div = document.createElement('div');
        div.className = 'host';
        div.textContent = `${host.displayName} (${host.emails[0] || ''})`;
        div.onclick = () => selectHost(idx);
        resultsDiv.appendChild(div);
      });
    }

    function selectHost(idx) {
      selectedHost = hostList[idx];
      document.querySelectorAll('.host').forEach((el, i) => el.classList.toggle('selected', i === idx));
      document.getElementById("host-next-btn").disabled = false;
    }

    function nextFromHost() {
      if (selectedHost) {
        document.getElementById("confirm-msg").innerText =
          `Name: ${visitorName}\nHost: ${selectedHost.displayName}`;
        showPage('page-confirm');
      }
    }

    async function sendNotification() {
      if (!visitorName || !selectedHost) return;
      await fetch("https://webexapis.com/v1/messages", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${WEBEX_TOKEN}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          toPersonEmail: selectedHost.emails[0],
          text: `You have a visitor: ${visitorName} is here to see you!`
        })
      });
      showPage('page-done');
    }
  </script>
</body>
</html>
